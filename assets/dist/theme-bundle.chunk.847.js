"use strict";(self.webpackChunkWebpackChiara=self.webpackChunkWebpackChiara||[]).push([[847],{90847:(t,e,r)=>{r.r(e),r.d(e,{default:()=>g});var a=r(42066),n=r(50469),o=r(28426),i=r(54587),s=r(55282),c=r(8575),d=r(28350),l=(r(51647),r(40097)),u=r(22609),h=r(55825);function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,a=new Array(e);r<e;r++)a[r]=t[r];return a}function p(t,e){return p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},p(t,e)}var g=function(t){var e,n;function g(){return t.apply(this,arguments)||this}n=t,(e=g).prototype=Object.create(n.prototype),e.prototype.constructor=e,p(e,n);var v=g.prototype;return v.formatCategoryTreeForJSTree=function(t){var e=this,r={text:t.data,id:t.metadata.id,state:{selected:t.selected}};return t.state&&(r.state.opened="open"===t.state,r.children=!0),t.children&&(r.children=[],t.children.forEach((function(t){r.children.push(e.formatCategoryTreeForJSTree(t))}))),r},v.showProducts=function(){var t=s.Z.replaceParams(window.location.href,{section:"product"});this.$productListingContainer.removeClass("u-hiddenVisually"),this.$facetedSearchContainer.removeClass("u-hiddenVisually"),this.$contentResultsContainer.addClass("u-hiddenVisually"),h("[data-content-results-toggle]").removeClass("navBar-action-color--active"),h("[data-content-results-toggle]").addClass("navBar-action"),h("[data-product-results-toggle]").removeClass("navBar-action"),h("[data-product-results-toggle]").addClass("navBar-action-color--active"),s.Z.goToUrl(t)},v.showContent=function(){var t=s.Z.replaceParams(window.location.href,{section:"content"});this.$contentResultsContainer.removeClass("u-hiddenVisually"),this.$productListingContainer.addClass("u-hiddenVisually"),this.$facetedSearchContainer.addClass("u-hiddenVisually"),h("[data-product-results-toggle]").removeClass("navBar-action-color--active"),h("[data-product-results-toggle]").addClass("navBar-action"),h("[data-content-results-toggle]").removeClass("navBar-action"),h("[data-content-results-toggle]").addClass("navBar-action-color--active"),s.Z.goToUrl(t)},v.onReady=function(){var t=this;(0,i.Z)(this.context.urls);var e=h("[data-advanced-search-form]"),r=e.find("[data-search-category-tree]"),n=c.parse(window.location.href,!0),o=[];this.$productListingContainer=h("#product-listing-container"),this.$facetedSearchContainer=h("#faceted-search-container"),this.$contentResultsContainer=h("#search-results-content"),h("#facetedSearch").length>0?this.initFacetedSearch():(this.onSortBySubmit=this.onSortBySubmit.bind(this),a.PT.on("sortBy-submitted",this.onSortBySubmit)),this.initInfiniteScroll(),(0,u.q)(),(0,d.ZP)(),h("[data-product-results-toggle]").on("click",(function(e){e.preventDefault(),t.showProducts()})),h("[data-content-results-toggle]").on("click",(function(e){e.preventDefault(),t.showContent()})),0===this.$productListingContainer.find("li.product").length||"content"===n.query.section?this.showContent():this.showProducts();var s=this.initValidation(e).bindValidation(e.find("#search_query_adv"));this.context.categoryTree.forEach((function(e){o.push(t.formatCategoryTreeForJSTree(e))})),this.categoryTreeData=o,this.createCategoryTree(r),e.on("submit",(function(t){var a=r.jstree().get_selected();if(!s.check())return t.preventDefault();e.find('input[name="category[]"]').remove();for(var n,o=function(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return f(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?f(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var a=0;return function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=t[Symbol.iterator]()).next.bind(r)}(a);!(n=o()).done;){var i=n.value,c=h("<input>",{type:"hidden",name:"category[]",value:i});e.append(c)}}))},v.loadTreeNodes=function(t,e){var r=this;h.ajax({url:"/remote/v1/category-tree",data:{selectedCategoryId:t.id,prefix:"category"},headers:{"x-xsrf-token":window.BCData&&window.BCData.csrf_token?window.BCData.csrf_token:""}}).done((function(t){var a=[];t.forEach((function(t){a.push(r.formatCategoryTreeForJSTree(t))})),e(a)}))},v.createCategoryTree=function(t){var e=this,r={core:{data:function(t,r){"#"===t.id?r(e.categoryTreeData):e.loadTreeNodes(t,r)},themes:{icons:!0}},checkbox:{three_state:!1},plugins:["checkbox"]};t.jstree(r)},v.initInfiniteScroll=function(){var t=this;this.context.themeSettings.searchpage_infiniteScroll&&r.e(795).then(r.bind(r,80795)).then((function(e){return e.initSearchPage(t.context)}))},v.initFacetedSearch=function(){var t=this.context,e=t.onMinPriceError,r=t.onMaxPriceError,a=t.minPriceNotEntered,n=t.maxPriceNotEntered,i=t.onInvalidPrice,s=h("#product-listing-container"),c=h("#faceted-search-container"),d=h("#search-results-heading"),l=h("#search-results-product-count"),u={template:{productListing:"search/product-listing",sidebar:"search/sidebar",heading:"search/heading",productCount:"search/product-count"},config:{product_results:{limit:this.context.searchProductsPerPage}},showMore:"search/show-more"};this.facetedSearch=new o.Z(u,(function(t){s.html(t.productListing),c.html(t.sidebar),d.html(t.heading),l.html(t.productCount),h("html, body").animate({scrollTop:0},100)}),{validationErrorMessages:{onMinPriceError:e,onMaxPriceError:r,minPriceNotEntered:a,maxPriceNotEntered:n,onInvalidPrice:i},context:this.context})},v.initValidation=function(t){return this.$form=t,this.validator=(0,l.Z)({submit:t}),this},v.bindValidation=function(t){return this.validator&&this.validator.add({selector:t,validate:"presence",errorMessage:t.data("errorMessage")}),this},v.check=function(){return!!this.validator&&(this.validator.performCheck(),this.validator.areAll("valid"))},g}(n.Z)}}]);